"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[842],{954:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Plugin Framework/Events","title":"Events","description":"An excellent way to handle communications between plugins, in addition to tags, is using the ETS2LA event system. While tags are more focused on sending large amounts of data, you can use the event system to send relatively small amounts of information very easily.","source":"@site/docs/03-Plugin Framework/03-Events.md","sourceDirName":"03-Plugin Framework","slug":"/Plugin Framework/Events","permalink":"/docs/Plugin Framework/Events","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Events"},"sidebar":"mainSidebar","previous":{"title":"User Interface","permalink":"/docs/Plugin Framework/User Interface"},"next":{"title":"Plugin Catalogue","permalink":"/docs/Plugin Framework/Plugin Catalogue"}}');var o=t(4848),r=t(8453);const i={title:"Events"},a=void 0,l={},c=[{value:"Why use events?",id:"why-use-events",level:3},{value:"How do I create and trigger events?",id:"how-do-i-create-and-trigger-events",level:3},{value:"How do I listen to events?",id:"how-do-i-listen-to-events",level:3},{value:"Suggestions or improvements?",id:"suggestions-or-improvements",level:3}];function d(e){const n={code:"code",em:"em",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["An excellent way to handle communications between plugins, in addition to ",(0,o.jsx)(n.strong,{children:"tags"}),", is using the ETS2LA event system. While tags are more focused on sending large amounts of data, you can use the event system to send ",(0,o.jsx)(n.em,{children:"relatively small"})," amounts of information very easily."]}),"\n",(0,o.jsx)(n.h3,{id:"why-use-events",children:"Why use events?"}),"\n",(0,o.jsxs)(n.p,{children:["Tags are fantastic, but they do come with a certain amount of boilerplate code. Tags also have to be constantly ",(0,o.jsx)(n.em,{children:"polled"}),' meaning your plugin has to ask the backend "is there an update yet?" instead of the backend sending the information as soon as it\'s ready.']}),"\n",(0,o.jsx)(n.p,{children:"The event system itself was built from a need for a more performant (and faster) way for plugins to send information and well, events, to each other."}),"\n",(0,o.jsx)(n.h3,{id:"how-do-i-create-and-trigger-events",children:"How do I create and trigger events?"}),"\n",(0,o.jsxs)(n.p,{children:["As with everything in ETS2LA this has been made to be as easy as possible for the Plugin developers. Below is some example code for ",(0,o.jsx)(n.em,{children:"defining"})," an event."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Plugins/MyPlugin/events.py\r\n\r\nfrom ETS2LA.Events import Event\r\n\r\nclass MyEvent(Event):\r\n    alias = "my_event"\r\n    some_data: str\r\n    some_other_data: float\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Notice how just like the settings system, you explicitly define the variables you want an event to contain. This is preferred since other plugins can import your event, and know exactly what they contain. ",(0,o.jsx)(n.strong,{children:"For this reason please make sure you define events in an"})," ",(0,o.jsx)(n.code,{children:"events.py"})," ",(0,o.jsx)(n.strong,{children:"(or similar) file. Make sure they don't import from your main plugin!"})]}),"\n",(0,o.jsxs)(n.p,{children:["Now to actually trigger events it's also very easy. You don't have to create an instance of the event, just call ",(0,o.jsx)(n.code,{children:"trigger"})," function on the class itself with the variables you want to send. ",(0,o.jsx)(n.em,{children:"(You can make a pure trigger event by not adding any variables to the class)"})]}),"\n",(0,o.jsxs)(n.p,{children:["Note that the ",(0,o.jsx)(n.code,{children:"trigger"})," function expects an ",(0,o.jsx)(n.code,{children:"EventSystem"})," instance, that can be imported from ",(0,o.jsx)(n.code,{children:"ETS2LA.Events"})," as well."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Plugins/MyPlugin/some_file.py\r\n\r\nfrom ETS2LA.Events import events\r\nfrom Plugins.MyPlugin.classes import MyEvent\r\n\r\n# You have to set the event information with kwargs\r\n# Args are not supported, and it makes code easier to read!\r\nMyEvent.trigger(events, \r\n    some_data="Hello World!", \r\n    some_other_data=15.49\r\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Events can be triggered from any file inside your plugin process. Once triggered, the backend will send a copy of this event to all plugins, they can then use the event data as they wish. If you want to use the events internally in the plugin, you can add ",(0,o.jsx)(n.code,{children:"queue=False"})," to the trigger call, and that will only emit the event inside the current plugin process."]}),"\n",(0,o.jsx)(n.h3,{id:"how-do-i-listen-to-events",children:"How do I listen to events?"}),"\n",(0,o.jsx)(n.p,{children:"Listening to events works much the same as triggering them. There's two ways to do it, but one is preferred over the other. We're keeping both ways alive until the controls system gets refactored to take into account new changes."}),"\n",(0,o.jsxs)(n.p,{children:["Probably the most useful, as well as the most used way of listening to events is using ",(0,o.jsx)(n.code,{children:"events.on"}),". The code below should be fairly self explanatory."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Plugins/MyOtherPlugin/some_file.py\r\n\r\nfrom ETS2LA.Events import events\r\nfrom Plugins.MyPlugin.classes import MyEvent\r\n\r\n@events.on(MyEvent)\r\ndef my_event_callback(event_instance: MyEvent, *args, **kwargs):\r\n    event_instance.some_data # Hello World!\r\n    kwargs["some_data"] # Hello World!\r\n\r\n# You can also listen to events *without* importing the class\r\n# This will just omit intellisense on the event_instance, so using the class is preferred.\r\n@events.on("my_event")\r\ndef my_event_callback_classless(event_instance, *args, **kwargs):\r\n    ...\n'})}),"\n",(0,o.jsxs)(n.p,{children:["As you can see, we provide the raw ",(0,o.jsx)(n.code,{children:"Event"})," instance, as well as the args and kwargs it was called with. In most situations you will only use the instance, but the args and kwargs are there for backwards compatibility. ",(0,o.jsx)(n.em,{children:"You still need to define"})," ",(0,o.jsx)(n.code,{children:"*args"})," ",(0,o.jsx)(n.em,{children:"and"})," ",(0,o.jsx)(n.code,{children:"**kwargs"})," ",(0,o.jsx)(n.em,{children:"or python will complain!"})]}),"\n",(0,o.jsxs)(n.p,{children:["Now in addition to listening for triggers, you can also wait until an event is triggered in a thread or the main process. Please note that it's recommended to ",(0,o.jsx)(n.em,{children:"not"})," block the main plugin process inside the ",(0,o.jsx)(n.code,{children:"run"})," function. You should always create a thread listener."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Plugins/MyOtherPlugin/some_file.py\r\n\r\nfrom ETS2LA.Events import events\r\nfrom Plugins.MyPlugin.classes import MyEvent\r\n\r\ntry:\r\n    event_instance, args, kwargs = events.wait_for(MyEvent, timeout=5)\r\n    event_instance.some_data # Hello World!\r\nexcept TimeoutError:\r\n    print("Timed out")\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The current thread will wait at the events call until the event is triggered from somewhere, or it reaches a timeout, in which case it will raise a ",(0,o.jsx)(n.code,{children:"TimeoutError"}),". Remember to always handle timeout cases! By default ETS2LA will assume a 5 second timeout, you can adjust that however you want."]}),"\n",(0,o.jsx)(n.h3,{id:"suggestions-or-improvements",children:"Suggestions or improvements?"}),"\n",(0,o.jsxs)(n.p,{children:["If you want us to add any features to the Event system then just ping ",(0,o.jsx)(n.strong,{children:"@Tumppi066"})," on Discord or send a message to ",(0,o.jsx)(n.code,{children:"contact@ets2la.com"})," and we'll see what we can do \ud83d\udc4d"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(6540);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);